name: Deploy happywork-cms to Cloudflare Pages

on:
  workflow_call:
    inputs:
      branch:
        required: true
        type: string
      cloudflare-page-name:
        required: true
        type: string
      artifact-name:
        required: true
        type: string
      aws-account-id:
        required: true
        type: string
      api-url:
        required: true
        type: string

jobs:
  run-test:
    uses: JenosizeHW/happywork-github-reuse-workflow/.github/workflows/happywork-cms-test.yaml@main

  build:
    needs: ["run-test"]
    uses: JenosizeHW/happywork-github-reuse-workflow/.github/workflows/happywork-cms-build.yaml@main
    with:
      artifact-name: ${{ inputs.artifact-name }}
      api-url: ${{ inputs.api-url }}

  deploy:
    needs: ["build"]
    uses: JenosizeHW/happywork-github-reuse-workflow/.github/workflows/happywork-cms-deploy.yaml@main
    with:
      branch: ${{ inputs.branch }}
      cloudflare-page-name: ${{ inputs.cloudflare-page-name }}
      artifact-name: ${{ inputs.artifact-name }}
      aws-account-id: ${{ inputs.aws-account-id }}
      api-url: ${{ inputs.api-url }}
